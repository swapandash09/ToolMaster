<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ToolMaster AI - Fixed Version</title>
    
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
        /* CSS COMBINED FOR STABILITY */
        :root { --bg: #09090b; --sidebar: rgba(20, 20, 24, 0.8); --card: rgba(30, 30, 35, 0.6); --border: rgba(255, 255, 255, 0.08); --primary: #6366f1; --text: #ffffff; --text-muted: #a1a1aa; --font: 'Outfit', sans-serif; }
        body.light-mode { --bg: #f3f4f6; --sidebar: rgba(255, 255, 255, 0.9); --card: #ffffff; --border: rgba(0, 0, 0, 0.08); --text: #18181b; --text-muted: #52525b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font); }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        /* Layout */
        .app-container { display: flex; height: 100%; width: 100%; }
        .desktop-sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 24px; display: flex; flex-direction: column; }
        .content-area { flex: 1; overflow-y: auto; padding: 30px; position: relative; }
        
        /* Sidebar Elements */
        .brand-area { display: flex; align-items: center; gap: 12px; margin-bottom: 40px; font-size: 1.2rem; font-weight: 700; }
        .logo-icon { width: 36px; height: 36px; background: var(--primary); border-radius: 8px; display: grid; place-items: center; color: white; }
        .side-nav li { padding: 12px; border-radius: 10px; cursor: pointer; color: var(--text-muted); display: flex; gap: 10px; margin-bottom: 5px; transition: 0.2s; }
        .side-nav li:hover, .side-nav li.active { background: rgba(99,102,241,0.1); color: var(--primary); }
        
        /* Dashboard Cards */
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .t-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 16px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s; }
        .t-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .tc-icon { width: 45px; height: 45px; border-radius: 12px; display: grid; place-items: center; font-size: 1.4rem; color: white; }
        
        /* Colors */
        .c-blue { background: #3b82f6; } .c-green { background: #10b981; } .c-purple { background: #8b5cf6; } .c-red { background: #ef4444; } 
        .c-dark { background: #1f2937; } .c-pink { background: #ec4899; } .c-teal { background: #14b8a6; } .c-yellow { background: #eab308; }
        
        /* Workspace */
        .tool-workspace { max-width: 1000px; margin: 0 auto; animation: fade 0.4s; }
        .hidden { display: none !important; }
        .ws-head { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; }
        .ws-body { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 30px; }
        .back-pill { background: rgba(255,255,255,0.1); border: 1px solid var(--border); color: var(--text); padding: 8px 16px; border-radius: 30px; cursor: pointer; }
        
        /* Form Elements */
        .glass-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: 10px; margin-bottom: 10px; outline: none; }
        .glow-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; margin-top: 10px; }
        .upload-zone { border: 2px dashed var(--border); padding: 40px; text-align: center; border-radius: 15px; cursor: pointer; margin-bottom: 20px; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .desktop-sidebar { display: none; }
            .content-area { padding: 15px 15px 80px 15px; }
            .tool-grid { grid-template-columns: 1fr 1fr; }
        }
        @keyframes fade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Toast & Loader */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
        .toast { background: #1f2937; color: white; padding: 12px 20px; margin-top: 10px; border-radius: 8px; border-left: 4px solid var(--primary); animation: fade 0.3s; }
        #loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .loader-circle { width: 40px; height: 40px; border: 4px solid #fff; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div id="loading-overlay" class="hidden"><div class="loader-circle"></div></div>

    <div class="app-container">
        <aside class="desktop-sidebar">
            <div class="brand-area"><div class="logo-icon"><i class="ri-flashlight-fill"></i></div> ToolMaster</div>
            <ul class="side-nav">
                <li onclick="showHome()"><i class="ri-dashboard-line"></i> Dashboard</li>
                <li onclick="openTool('resume-tool')"><i class="ri-article-line"></i> Resume</li>
                <li onclick="openTool('excel-tool')"><i class="ri-file-excel-line"></i> Excel PDF</li>
                <li onclick="openTool('bg-remover-tool')"><i class="ri-magic-line"></i> Eraser</li>
            </ul>
        </aside>

        <main class="content-area">
            <div id="home-page" class="view-section">
                <h1 style="margin-bottom:20px;">Welcome Back ðŸ‘‹</h1>
                <div class="tool-grid">
                    <div class="t-card" onclick="openTool('resume-tool')"><div class="tc-icon c-blue"><i class="ri-article-line"></i></div><div><h4>Resume</h4><p>Builder</p></div></div>
                    <div class="t-card" onclick="openTool('excel-tool')"><div class="tc-icon c-green"><i class="ri-file-excel-2-line"></i></div><div><h4>Excel</h4><p>To PDF</p></div></div>
                    <div class="t-card" onclick="openTool('bg-remover-tool')"><div class="tc-icon c-purple"><i class="ri-magic-line"></i></div><div><h4>Eraser</h4><p>Remove BG</p></div></div>
                    <div class="t-card" onclick="openTool('img-tool')"><div class="tc-icon c-red"><i class="ri-file-zip-line"></i></div><div><h4>Compress</h4><p>Image</p></div></div>
                </div>
            </div>

            <div id="resume-tool" class="tool-workspace hidden">
                <div class="ws-head"><button class="back-pill" onclick="showHome()">Back</button><h2>Resume Builder</h2></div>
                <div class="ws-body">
                    <input type="text" class="glass-input" id="res-name-in" placeholder="Full Name" oninput="updateRes()">
                    <input type="text" class="glass-input" id="res-role-in" placeholder="Job Title" oninput="updateRes()">
                    <textarea class="glass-input" id="res-sum-in" placeholder="Summary..." oninput="updateRes()"></textarea>
                    <button class="glow-btn" onclick="dlResume()">Download PDF</button>
                    
                    <div id="res-preview" style="background:white; color:black; padding:30px; margin-top:20px; min-height:400px;">
                        <h1 id="r-name">NAME</h1>
                        <p id="r-role" style="color:blue; font-weight:bold;">TITLE</p>
                        <hr>
                        <p id="r-sum">Summary goes here...</p>
                    </div>
                </div>
            </div>

            <div id="excel-tool" class="tool-workspace hidden">
                <div class="ws-head"><button class="back-pill" onclick="showHome()">Back</button><h2>Excel to PDF</h2></div>
                <div class="ws-body">
                    <div class="upload-zone" onclick="document.getElementById('excel-input').click()"><p>Upload .xlsx</p><input type="file" id="excel-input" accept=".xlsx"></div>
                    <button class="glow-btn" onclick="genExcelPDF()">Convert</button>
                    <div id="excel-prev" style="background:white; color:black; margin-top:20px; padding:10px; max-height:300px; overflow:auto;"></div>
                </div>
            </div>

            <div id="bg-remover-tool" class="tool-workspace hidden">
                <div class="ws-head"><button class="back-pill" onclick="showHome()">Back</button><h2>Magic Eraser</h2></div>
                <div class="ws-body">
                    <div class="upload-zone" onclick="document.getElementById('bg-in').click()"><p>Upload Image</p><input type="file" id="bg-in" accept="image/*"></div>
                    <img id="bg-res" style="max-width:100%; border:1px solid #555; margin-top:20px;">
                </div>
            </div>

        </main>
    </div>

    <script>
        // NAVIGATION
        function showHome() {
            document.querySelectorAll('.tool-workspace').forEach(e => e.classList.add('hidden'));
            document.getElementById('home-page').classList.remove('hidden');
        }
        function openTool(id) {
            document.getElementById('home-page').classList.add('hidden');
            document.querySelectorAll('.tool-workspace').forEach(e => e.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }
        function loader(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
        }
        function showToast(msg) {
            const t = document.getElementById('toast-container');
            const d = document.createElement('div');
            d.className = 'toast'; d.innerText = msg;
            t.appendChild(d); setTimeout(() => d.remove(), 3000);
        }

        // RESUME LOGIC
        function updateRes() {
            document.getElementById('r-name').innerText = document.getElementById('res-name-in').value || 'NAME';
            document.getElementById('r-role').innerText = document.getElementById('res-role-in').value || 'TITLE';
            document.getElementById('r-sum').innerText = document.getElementById('res-sum-in').value || 'Summary...';
        }
        function dlResume() {
            loader(true);
            const element = document.getElementById('res-preview');
            html2pdf().from(element).save('Resume.pdf').then(() => loader(false));
        }

        // EXCEL LOGIC
        document.getElementById('excel-input').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.readAsArrayBuffer(e.target.files[0]);
            reader.onload = (ev) => {
                const wb = XLSX.read(new Uint8Array(ev.target.result), {type:'array'});
                const html = XLSX.utils.sheet_to_html(wb.Sheets[wb.SheetNames[0]]);
                document.getElementById('excel-prev').innerHTML = html;
            }
        });
        function genExcelPDF() {
            const el = document.getElementById('excel-prev');
            if(!el.innerText) return showToast("Upload File First");
            loader(true);
            html2pdf().from(el).save('Excel.pdf').then(() => loader(false));
        }

        // BACKGROUND REMOVER
        document.getElementById('bg-in').addEventListener('change', async (e) => {
            loader(true);
            const file = e.target.files[0];
            const img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = async () => {
                try {
                    const { removeBackground } = await import('https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.5.5/+esm');
                    const blob = await removeBackground(img.src);
                    document.getElementById('bg-res').src = URL.createObjectURL(blob);
                } catch(err) {
                    console.error(err);
                    showToast("Error: Use Local Server");
                }
                loader(false);
            }
        });
    </script>
</body>
</html>
